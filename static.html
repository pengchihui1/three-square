<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>threejs-basic-geometry</title>
    <style>
        body{
            font-family: Monospace;
            background: #f0f0f0;
            margin: 0px;
            overflow: hidden;
        }
    </style>
</head>
<body>

<script type="module">
  import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.124/build/three.module.js';
  import { GUI } from 'https://cdn.jsdelivr.net/npm/three@0.124/examples/jsm/libs/dat.gui.module.js';
  import Stats from 'https://cdn.jsdelivr.net/npm/three@0.124/examples/jsm/libs/stats.module.js';
  import { CinematicCamera } from 'https://cdn.jsdelivr.net/npm/three@0.124/examples/jsm/cameras/CinematicCamera.js';
   
    var camera, scene, renderer,raycaster,container;

    const mouse = new THREE.Vector2();
	let INTERSECTED;//當前點擊對象
    main();
    render();

    //主函数
    function main(){
        //添加一个div元素
        container = document.createElement('div')
        document.body.appendChild(container);
        scene = new THREE.Scene();//创建一个新场景
        //添加一个透视相机
        camera = new THREE.PerspectiveCamera(30,window.innerWidth/window.innerHeight, 1, 1000);
        camera.position.set(100, 300, 100);//设置相机位置
        camera.lookAt(new THREE.Vector3(0,0,0));//让相机指向原点
        //渲染

        raycaster = new THREE.Raycaster();//3d世界鼠標選中物體獲取器

        //antialias:true增加抗锯齿效果
        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setClearColor(new THREE.Color(0x000000));//设置窗口背景颜色为黑
        renderer.setSize(window.innerWidth, window.innerHeight);//设置窗口尺寸
        //将renderer关联到container，这个过程类似于获取canvas元素
        container.appendChild(renderer.domElement);
        //给场景添加光源
        //自然光
        var ambientLight = new THREE.AmbientLight( 0x606060 );
        scene.add( ambientLight );
        //平行光源
        var directionalLight = new THREE.DirectionalLight( 0xffffff );
        directionalLight.position.set( 1, 0.75, 0.5 ).normalize();
        scene.add( directionalLight );
        renderer.domElement.addEventListener('click', onClick, false);
        plane();
        cube();
        // sphere();
        // cylinder();
    }

    //创建一个平面
    function plane(){
        var planeGeo = new THREE.PlaneGeometry(150,150,10,10);//创建平面
        var planeMat = new THREE.MeshLambertMaterial({  //创建材料
            color:0x999999,
            wireframe:false
        });
        var planeMesh = new THREE.Mesh(planeGeo, planeMat);//创建网格模型

        planeMesh.position.set(0, 0, -20);//设置平面的坐标
        planeMesh.rotation.x = -0.5 * Math.PI;//将平面绕X轴逆时针旋转90度
        // planeMesh.position.y = 10;
        // planeMesh.position.z = 10;
        scene.add(planeMesh);//将平面添加到场景中

        // 網格狀地板
        const grid = new THREE.GridHelper(2000, 20, 0x000000, 0x000000);
        grid.material.opacity = 0.2;
        
        grid.material.transparent = true;
        scene.add(grid);
    }

    //创建一个立方体
    function cube(){
        for(var i=0;i<3;i++){
            var cubeGeo = new THREE.CubeGeometry(20, 20, 20, 5, 5, 5);//创建立方体
            var cubeMat = new THREE.MeshLambertMaterial({//创建材料
                color:"red",
                wireframe:false,
            });
            var cubeMesh = new THREE.Mesh(cubeGeo, cubeMat);//创建立方体网格模型
            cubeMesh.position.set(10*i*4, 10*5,0);//设置立方体的坐标
            cubeMesh.name=`cube${i+1}`
            scene.add(cubeMesh);//将立方体添加到场景中
        }
    }
  

    //创建一个球
    function sphere(){
        var sphereGeo = new THREE.SphereGeometry(16, 40, 40);//创建球体
        var sphereMat = new THREE.MeshLambertMaterial({//创建材料
            color:0x0000FF,
            wireframe:false
        });
        var sphereMesh = new THREE.Mesh(sphereGeo, sphereMat);//创建球体网格模型
        sphereMesh.position.set(-25, 10, 0);//设置球的坐标
        scene.add(sphereMesh);//将球体添加到场景
    }

    //创建圆柱体
    function cylinder(){
        //创建圆柱体
        var cylinderGeo = new THREE.CylinderGeometry(15, 15 ,40 ,40 ,40);
        var cylinderMat = new THREE.MeshLambertMaterial({//创建材料
            color:0xFF6600,
            wireframe:false
        });
        //创建圆柱体网格模型
        var cylinderMesh = new THREE.Mesh(cylinderGeo, cylinderMat);
        cylinderMesh.position.set(0, 20, -40);//设置圆柱坐标
        scene.add(cylinderMesh);//向场景添加圆柱体
    }
    
    //渲染
    function render(){
        renderer.render(scene, camera);
    }
    
    function onClick( event ) {
        event.preventDefault();
        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

        // 获取鼠标点击的3D模型
        raycaster.setFromCamera( mouse, camera );
        var intersects = raycaster.intersectObjects( scene.children, true );
    
        if ( intersects.length > 0 ) {
             // 點擊到3D內容
            const object = intersects[0].object;
            switch(object?.name){
                case "cube1":alert("cube1");break;
                case "cube2":alert("cube2");break;
                case "cube3":alert("cube3");break;
            }
        }
    }
 
</script>
</body>
</html>